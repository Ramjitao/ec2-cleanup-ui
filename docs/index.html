<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EC2 Volume Cleanup Trigger</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      background: #f9f9f9;
    }
    form {
      background: white;
      padding: 2em;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select {
      width: 100%;
      padding: 0.5em;
      margin: 0.5em 0 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background-color: #007bff;
      color: white;
      padding: 0.7em 1.5em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .message {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Trigger EC2 Volume Cleanup</h2>

<form id="cleanupForm">
  <label>AWS Region:</label>
  <input type="text" name="region" value="eu-west-1" required />

  <label>Auto Confirm Deletion:</label>
  <select name="auto_confirm" required>
    <option value="false">No</option>
    <option value="true">Yes</option>
  </select>

  <label>AWS Access Key ID:</label>
  <input type="text" name="access_key_id" required />

  <label>AWS Secret Access Key:</label>
  <input type="password" name="secret_access_key" required />

  <label>AWS Session Token (optional):</label>
  <input type="text" name="session_token" />

  <label>Your GitHub PAT (with repo & workflow scopes):</label>
  <input type="password" name="github_pat" required />

  <label>GitHub Repo (format: owner/repo):</label>
  <input type="text" name="repo" required />

  <label>Workflow File Name (e.g. ec2-cleanup.yml):</label>
  <input type="text" name="workflow" required />

  <button type="submit">Run Cleanup</button>

  <div class="message" id="message"></div>
</form>

<script>
  document.getElementById("cleanupForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    const form = e.target;
    const messageEl = document.getElementById("message");

    const repo = form.repo.value.trim();
    const workflow = form.workflow.value.trim();
    const url = `https://api.github.com/repos/${repo}/actions/workflows/${workflow}/dispatches`;

    const payload = {
      ref: "main", // or your default branch
      inputs: {
        region: form.region.value,
        auto_confirm: form.auto_confirm.value,
        access_key_id: form.access_key_id.value,
        secret_access_key: form.secret_access_key.value,
        session_token: form.session_token.value
      }
    };

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${form.github_pat.value}`,
          "Accept": "application/vnd.github+json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (res.status === 204) {
        messageEl.textContent = "✅ Workflow triggered successfully!";
        messageEl.style.color = "green";
      } else {
        const error = await res.json();
        messageEl.textContent = `❌ Error: ${JSON.stringify(error)}`;
        messageEl.style.color = "red";
      }
    } catch (err) {
      messageEl.textContent = `❌ Exception: ${err.message}`;
      messageEl.style.color = "red";
    }
  });
</script>

</body>
</html>
