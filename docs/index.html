<!DOCTYPE html>
<html>
<head>
  <title>EC2 Volume Cleanup</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    input, select, button { padding: 0.5rem; margin: 0.5rem 0; width: 100%; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>üßπ EC2 Volume Cleanup Trigger</h1>

  <label>Region (default: eu-west-1)</label>
  <input type="text" id="region" placeholder="eu-west-1" />

  <label>Auto-confirm delete?</label>
  <select id="auto_confirm">
    <option value="true" selected>Yes</option>
    <option value="false">No</option>
  </select>

  <label>Your GitHub PAT (repo scope)</label>
  <input type="password" id="pat" placeholder="ghp_..." />

  <button onclick="runCleanup()">üöÄ Trigger Cleanup</button>

  <h2>Status:</h2>
  <pre id="result">Waiting...</pre>

  <script>
    async function runCleanup() {
      const repoOwner = "Ramjitao";
      const repoName = "ec2-cleanup-ui";
      const workflowFile = "cleanup-volumes.yml";

      const region = document.getElementById('region').value || "eu-west-1";
      const auto_confirm = document.getElementById('auto_confirm').value;
      const pat = document.getElementById('pat').value;

      const resultBox = document.getElementById('result');
      resultBox.textContent = "üîÑ Sending request...";

      try {
        const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/actions/workflows/${workflowFile}/dispatches`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${pat}`,
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            ref: "main",
            inputs: {
              region: region,
              auto_confirm: auto_confirm
            }
          })
        });

        if (response.status === 204) {
          resultBox.textContent = "‚úÖ Cleanup triggered successfully!";
        } else {
          const error = await response.text();
          resultBox.textContent = `‚ùå Failed: ${error}`;
        }
      } catch (err) {
        resultBox.textContent = `‚ùå Error: ${err.message}`;
      }
    }
  </script>
</body>
</html>
